import{a as V,b as C}from"./chunk-H45W23EV.js";import{a as y}from"./chunk-A5RVBUJG.js";import{b as I,d as P}from"./chunk-CEXNNX6R.js";import{a as O,b as H,c as x}from"./chunk-NNQQA277.js";import{Aa as R,Ba as h,K as v,Ka as g,O as w,P as u,Q as d,S as m,Za as M,la as S,sa as T,ta as j,za as _}from"./chunk-WQG4OH5T.js";var $=(()=>{let o=class o{};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=m({type:o,selectors:[["app-spinner"]],standalone:!0,features:[g],decls:1,vars:0,consts:[[1,"loader","bg-primary","text-primary"]],template:function(e,n){e&1&&h(0,"span",0)},styles:['.loader[_ngcontent-%COMP%]{width:8px;height:40px;border-radius:4px;display:block;margin:20px auto;position:relative;box-sizing:border-box;animation:_ngcontent-%COMP%_animloader .3s .3s linear infinite alternate}.loader[_ngcontent-%COMP%]:after, .loader[_ngcontent-%COMP%]:before{content:"";width:8px;height:40px;border-radius:4px;background:currentColor;position:absolute;top:50%;transform:translateY(-50%);left:20px;box-sizing:border-box;animation:_ngcontent-%COMP%_animloader .3s .45s linear infinite alternate}.loader[_ngcontent-%COMP%]:before{left:-20px;animation-delay:0s}@keyframes _ngcontent-%COMP%_animloader{0%{height:48px}to{height:4px}}']});let s=o;return s})();var b=class{encodeKey(o){return encodeURIComponent(o)}encodeValue(o){return encodeURIComponent(o)}decodeKey(o){return decodeURIComponent(o)}decodeValue(o){return decodeURIComponent(o)}};var D=new w("basePath");var A=(()=>{let o=class o{constructor(t,e,n){this.httpClient=t,this.basePath="http://localhost:3000",this.defaultHeaders=new O,this.configuration=new C,n&&(this.configuration=n),typeof this.configuration.basePath!="string"&&(Array.isArray(e)&&e.length>0&&(e=e[0]),typeof e!="string"&&(e=this.basePath),this.configuration.basePath=e),this.encoder=this.configuration.encoder||new b}addToHttpParams(t,e,n){return typeof e=="object"&&!(e instanceof Date)?t=this.addToHttpParamsRecursive(t,e):t=this.addToHttpParamsRecursive(t,e,n),t}addToHttpParamsRecursive(t,e,n){if(e==null)return t;if(typeof e=="object")if(Array.isArray(e))e.forEach(r=>t=this.addToHttpParamsRecursive(t,r,n));else if(e instanceof Date)if(n!=null)t=t.append(n,e.toISOString().substring(0,10));else throw Error("key may not be null if value is Date");else Object.keys(e).forEach(r=>t=this.addToHttpParamsRecursive(t,e[r],n!=null?`${n}.${r}`:r));else if(n!=null)t=t.append(n,e);else throw Error("key may not be null if value is not object or array");return t}usersGet(t="body",e=!1,n){let r=this.defaultHeaders,i=n&&n.httpHeaderAccept;if(i===void 0){let p=["application/json"];i=this.configuration.selectHeaderAccept(p)}i!==void 0&&(r=r.set("Accept",i));let a=n&&n.context;a===void 0&&(a=new H);let c="json";i&&(i.startsWith("text")?c="text":this.configuration.isJsonMime(i)?c="json":c="blob");let l="/users";return this.httpClient.request("get",`${this.configuration.basePath}${l}`,{context:a,responseType:c,withCredentials:this.configuration.withCredentials,headers:r,observe:t,reportProgress:e})}usersPost(t,e="body",n=!1,r){if(t==null)throw new Error("Required parameter user was null or undefined when calling usersPost.");let i=this.defaultHeaders,a=r&&r.httpHeaderAccept;if(a===void 0){let U=["application/json"];a=this.configuration.selectHeaderAccept(U)}a!==void 0&&(i=i.set("Accept",a));let c=r&&r.context;c===void 0&&(c=new H);let l=["application/json"],p=this.configuration.selectHeaderContentType(l);p!==void 0&&(i=i.set("Content-Type",p));let f="json";a&&(a.startsWith("text")?f="text":this.configuration.isJsonMime(a)?f="json":f="blob");let F="/users";return this.httpClient.request("post",`${this.configuration.basePath}${F}`,{context:c,body:t,responseType:f,withCredentials:this.configuration.withCredentials,headers:i,observe:e,reportProgress:n})}};o.\u0275fac=function(e){return new(e||o)(u(x),u(D,8),u(C,8))},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let s=o;return s})();function k(s,o){s&1&&h(0,"app-spinner")}var Ce=(()=>{let o=class o{constructor(){this.spinnerService=d(V),this.usersApiService=d(A),this.activatedRoute=d(I),this.httpClient=d(x),this.router=d(P)}ngOnInit(){let t=this.activatedRoute.snapshot.queryParamMap.get("code")??"",e="https://accounts.spotify.com/api/token",n="authorization_code",r={"content-type":"application/x-www-form-urlencoded",Authorization:"Basic "+btoa(y.client_id+":"+y.client_secret)},i=new URLSearchParams;i.append("code",t),i.append("redirect_uri",y.redirect_uri),i.append("grant_type",n),this.httpClient.post(e,i,{headers:r}).subscribe(a=>{let c=a;this.httpClient.get("https://api.spotify.com/v1/me",{headers:{Authorization:`${c.token_type} ${c.access_token}`}}).subscribe(l=>{c.id_user=l.id,this.usersApiService.usersPost(c).subscribe(p=>{localStorage.setItem("spotifai-creds",JSON.stringify(p)),this.router.navigate(["/main"])})})})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=m({type:o,selectors:[["app-auth-callback"]],standalone:!0,features:[g],decls:2,vars:1,consts:[[1,"flex","items-center","justify-center","w-screen","h-screen"]],template:function(e,n){e&1&&(_(0,"div",0),T(1,k,1,0,"app-spinner"),R()),e&2&&(S(1),j(1,n.spinnerService.getRequests()!==0?1:-1))},dependencies:[M,$]});let s=o;return s})();export{Ce as AuthCallbackComponent};
